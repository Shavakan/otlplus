{% extends "review/layout.html" %}
{% load staticfiles %}

{% block title %}
  {{ block.super }}
{% endblock %}

{% block metatags %}
  {{ block.super }}
{% endblock %}

{% block stylesheets %}
  {{ block.super }}
{% endblock %}

{% block javascripts %}
  {{ block.super }}
  <script type="text/javascript">
    $('#category').on('focus', function() {
      $('#m-category').modal('show');
    });

    $(document).ready(function() {
      {% if 'by_professor' in gets %}
        $('#by_professor').addClass('active');
        $("input:checkbox[name='by_professor']").attr("checked", true);
      {% endif %}
    });

    $('#by_professor').click(function() {
      if ($("input:checkbox[name='by_professor']").is(":checked"))
      {
        $('#by_professor').removeClass('active');
        $("input:checkbox[name='by_professor']").attr("checked", false);
      }
      else
      {
        $('#by_professor').addClass('active');
        $("input:checkbox[name='by_professor']").attr("checked", true);
      }
      
      gets = []
      {% for get in gets %}
        gets.push('{{get}}');
      {% endfor %}
      filters = $('#filters>div>label>input');
      for (i=0; i<filters.length; i++)
        if (gets.indexOf(filters[i].name)!=-1)
          filters[i].checked = true;
        else
          filters[i].checked = false;
      $('#filter_form').submit()
    });

    $('#sort_name').show();
    $('#sort_grade').hide();
    $('#sort_speech').hide();
    $('#sort_load').hide();
    $('#sort_total').hide();
    
    $(document).ready(function(){
      $("input[name='sorting']").on("change",function(){
        var test=$(this).val();
        $(".sort_result").hide();
        $("#sort_"+test).show();
      });
    });

    $('div.resultlist>a').click(function(){
      lis = $('div.resultlist>a');
      for (i=0; i<lis.length; i++)
        if (lis[i].href == this.href)
          lis[i].classList.add("active");
        else
          lis[i].classList.remove("active");
    });

  </script>
{% endblock %}

{% block header %}
  {{ block.super }}
{% endblock %}

{% block contents %}
  <form role="form" class="form" method="get" id="filter_form">
    <div id="m-category" class="modal fade">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
            <h4 class="modal-title">Category 검색</h4>
          </div>
          <div class="modal-body">
            <div class="row">
              <div class="col-xs-24" id="filters">
                <p>학과</p>
                <div class="btn-group" data-toggle="buttons">
                  <label class="btn btn-primary">
                    <input type="checkbox" autocomplete="off" name="CS"> 전산과
                  </label>
                  <label class="btn btn-primary">
                    <input type="checkbox" autocomplete="off" name="EE"> 전자과
                  </label>
                  <label class="btn btn-primary">
                    <input type="checkbox" autocomplete="off" name="MAE"> 기계과
                  </label>
                  <label class="btn btn-primary">
                    <input type="checkbox" autocomplete="off" name="HSS"> 인문사회과학부
                  </label>
                </div>
                <p>구분</p>
                <div class="btn-group" data-toggle="buttons">
                  <label class="btn btn-primary">
                    <input type="checkbox" autocomplete="off" name="BR"> 기필
                  </label>
                  <label class="btn btn-primary">
                    <input type="checkbox" autocomplete="off" name="BE"> 기선
                  </label>

                  <label class="btn btn-primary">
                    <input type="checkbox" autocomplete="off" name="MR"> 전필
                  </label>
                  <label class="btn btn-primary">
                    <input type="checkbox" autocomplete="off" name="ME"> 전선
                  </label>
                  <label class="btn btn-primary">
                    <input type="checkbox" autocomplete="off" name="MGC"> 교필
                  </label>
                  <label class="btn btn-primary">
                    <input type="checkbox" autocomplete="off" name="HSE"> 인문사회선택
                  </label>
                </div>
              </div>
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-primary" data-dismiss="modal">확인</button>
          </div>
        </div>
      </div>
    </div>

    <div class="row" style="margin-top: 50px;">
      <div class="col-xs-6">
      </div>
      <div class="col-xs-6">
        <input id="category" type="text" class="form-control">
      </div>
      <div class="col-xs-6">
        <input type="text" class="form-control">
      </div>
      <div class="col-xs-6">
        <input type="submit" class="btn btn-primary" value="검색" id="search">
      </div>
    </div>
    <div class="row" style="margin-top: 50px;">
      <div class="col-xs-24 text-left">
        <div class="btn-group" data-toggle="buttons">
          <label class="btn btn-primary" id="by_professor">
            <input type="checkbox" autocomplete="off" name="by_professor"> 교수 별로 보기
          </label>
        </div>
        <div class="btn-group btn-sort" data-toggle="buttons">
          <label class="btn btn-primary active">
            <input type="radio" id="name" name="sorting" value="name" autocomplete="off" checked>과목코드 순서대로 보기
          </label>
          <label class="btn btn-primary">
            <input type="radio" id="grade" name="sorting" value="grade" autocomplete="off"> 학점 잘 주는 순서대로 보기
          </label>
          <label class="btn btn-primary">
            <input type="radio" id="speech" name="sorting" value="speech" autocomplete="off"> 수업 잘 하는 순서대로 보기
          </label>
          <label class="btn btn-primary">
            <input type="radio" id="load" name="sorting" value="load" autocomplete="off"> 로드 덜 빡센 순서대로 보기
          </label>
          <label class="btn btn-primary">
            <input type="radio" id="total" name="sorting" value="total" autocomplete="off"> 전체적인 평가 순서대로 보기
          </label>
        </div>
      </div>
    </div>
  </form>


  <div class="row" style="margin-top: 50px;">
    <div class="col-xs-12 sort_result" id="sort_name">
      <div class="list-group resultlist" role="tablist">
      {% if results|length == 0 %}
        <div class="list-group-item">
          검색 결과가 없습니다.
        </div>
      {% endif %}
      {% for result in results %}
          <a href="{{ "#lecture"|add:result.3 }}" class="list-group-item" aria-controls="home" role="tab" data-toggle="tab">
            {{ result.0.0.title }}
          {% if result.0.1 != None %}
            : {{ result.0.1.professor_name }}
          {% endif %}
            </br>
          {% if result.2 != 0 %}
            grade : {{ result.1.0 }}
            load : {{ result.1.1 }}
            speech : {{ result.1.2 }}
            total : {{ result.1.3 }}</br>
            {{ result.2 }}개의 평가
          {% else %}
            -</br>
            평가 없음</br>
          {% endif %}
          </a>
      {% endfor %}
      </div>
    </div>
    <div class="col-xs-12 sort_result" id="sort_grade">
      <div class="list-group resultlist" role="tablist">
      {% if results|length == 0 %}  
        <div class="list-group-item">
          검색 결과가 없습니다.
        </div>
      {% endif %}
      {% for result in results_grade %}
        <a href="{{ "#lecture"|add:result.3 }}" class="list-group-item" aria-controls="home" role="tab" data-toggle="tab">
            {{ result.0.0.title }}
          {% if result.0.1 != None %}
            : {{ result.0.1.professor_name }}
          {% endif %}
            </br>
          {% if result.2 != 0 %}
            grade : {{ result.1.0 }}
            load : {{ result.1.1 }}
            speech : {{ result.1.2 }}
            total : {{ result.1.3 }}</br>
            {{ result.2 }}개의 평가
          {% else %}
            -</br>
            평가 없음</br>
          {% endif %}
          </a>
      {% endfor %}
      </div>
    </div>
    <div class="col-xs-12 sort_result" id="sort_speech">
      <div class="list-group resultlist" role="tablist">
      {% if results|length == 0 %}  
        <div class="list-group-item">
          검색 결과가 없습니다.
        </div>
      {% endif %}
      {% for result in results_speech %}
        <a href="{{ "#lecture"|add:result.3 }}" class="list-group-item" aria-controls="home" role="tab" data-toggle="tab">
           {{ result.0.0.title }}
          {% if result.0.1 != None %}
            : {{ result.0.1.professor_name }}
          {% endif %}
            </br>
          {% if result.2 != 0 %}
            grade : {{ result.1.0 }}
            load : {{ result.1.1 }}
            speech : {{ result.1.2 }}
            total : {{ result.1.3 }}</br>
            {{ result.2 }}개의 평가
          {% else %}
            -</br>
            평가 없음</br>
          {% endif %}
        </a>
      {% endfor %}
      </div>
    </div>
    <div class="col-xs-12 sort_result" id="sort_load">
      <div class="list-group resultlist" role="tablist">
      {% if results|length == 0 %}  
        <div class="list-group-item">
          검색 결과가 없습니다.
        </div>
      {% endif %}
      {% for result in results_load %}
        <a href="{{ "#lecture"|add:result.3 }}" class="list-group-item" aria-controls="home" role="tab" data-toggle="tab">
            {{ result.0.0.title }}
          {% if result.0.1 != None %}
            : {{ result.0.1.professor_name }}
          {% endif %}
            </br>
          {% if result.2 != 0 %}
            grade : {{ result.1.0 }}
            load : {{ result.1.1 }}
            speech : {{ result.1.2 }}
            total : {{ result.1.3 }}</br>
            {{ result.2 }}개의 평가
          {% else %}
            -</br>
            평가 없음</br>
          {% endif %}
          </a>
      {% endfor %}
      </div>
    </div>
    <div class="col-xs-12 sort_result" id="sort_total">
      <div class="list-group resultlist" role="tablist">
      {% if results|length == 0 %}  
        <div class="list-group-item">
          검색 결과가 없습니다.
        </div>
      {% endif %}
      {% for result in results_total %}
        <a href="{{ "#lecture"|add:result.3 }}" class="list-group-item" aria-controls="home" role="tab" data-toggle="tab">
            {{ result.0.0.title }}
          {% if result.0.1 != None %}
            : {{ result.0.1.professor_name }}
          {% endif %}
            </br>
          {% if result.2 != 0 %}
            grade : {{ result.1.0 }}
            load : {{ result.1.1 }}
            speech : {{ result.1.2 }}
            total : {{ result.1.3 }}</br>
            {{ result.2 }}개의 평가
          {% else %}
            -</br>
            평가 없음</br>
          {% endif %}
          </a>
      {% endfor %}
      </div>
    </div>
    <div class="col-xs-12 tab-content">
    {% for result in results %}
      <div id="{{"lecture"|add:result.3 }}" role="tabpanel" class="tab-pane panel">
        <div class="panel-default">
          <ul class="list-group">
          {% for review in result.4 %}
            <li class="list-group-item">
            {{ review.lecture.year }}년 {{ review.lecture.semester }}학기 - {{ review.writer.user.id }}</br>
              {{ review.comment }}</br>
              grade : {{ review.grade }}
              load : {{ review.load }}
              speech : {{ review.speech }}
              total : {{ review.total }}</br>
              <button class="btn btn-default">
                좋아요 {{ review.like }}
              </button>
            </li>
          {% endfor %}
          </ul>
        </div>
      </div>
    {% endfor %}
    </div>
  </div>
{% endblock %}

{% block footer %}
  {{ block.super }}
{% endblock %}
