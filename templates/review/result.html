{% extends "review/layout.html" %}
{% load staticfiles %}

{% block title %}
  {{ block.super }}
{% endblock %}

{% block metatags %}
  {{ block.super }}
{% endblock %}

{% block stylesheets %}
  {{ block.super }}
  <link rel="stylesheet" type="text/css" href="/media/css/components/header/result.css">
  <link rel="stylesheet" type="text/css" href="/media/css/review/components/option.css">
  <link rel="stylesheet" type="text/css" href="/media/css/review/components/expect.css">
  <link rel="stylesheet" type="text/css" href="/media/css/review/components/course.css">
  <link rel="stylesheet" type="text/css" href="/media/css/review/components/review.css">
  <link rel="stylesheet" type="text/css" href="/media/css/review/result.css">
{% endblock %}

{% block javascripts %}
  {{ block.super }}
  {% include 'review/components/filter.js.html' %}
  <script type="text/javascript" src="/media/js/review/result.js"></script>
  <script type="text/javascript" src="/media/js/review/components/option.js"></script>
  <script type="text/javascript" src="/media/js/review/components/course.js"></script>
<script>
$(document).ready(function(){     
    $(window).bind('scroll', loadOnScroll);
});
var pageNum = {{page}};
var hasNextPage = true;


var loadOnScroll = function() {
    if ($(window).scrollTop() > $(document).height() - ($(window).height()*2)) {
        $(window).unbind();
        loadItems();
    }
};

var loadItems = function() {
    if (hasNextPage === false) {
        alert("hasnoNextPage");
        return false
    }
    pageNum = pageNum + 1;
    var url = "/review/result/json/"+pageNum.toString() + "/?" + window.location.href.split("?").pop()
    $.ajax({
        type:"GET",
        url: url, 
        success: function(responseData) {
            var data = JSON.parse(responseData);
        },
        complete: function(data){
            $(window).bind('scroll', loadOnScroll);
        }
    });
};   
</script>

{% endblock %}

{% block header %}
  {% include 'components/header/result.html' %}
{% endblock %}

{% block contents %}
  <div class="row">
    <div class="col-xs-22 col-xs-offset-1 col-sm-20 col-sm-offset-2 col-md-18 col-md-offset-3 col-lg-16 col-lg-offset-4">
      {% include 'review/components/option.html' with with_filter=True %}
    </div>
    <div class="col-xs-22 col-xs-offset-1 col-sm-20 col-sm-offset-2 col-md-18 col-md-offset-3 col-lg-16 col-lg-offset-4">
      {% include 'review/components/course.html' with expectations=expectations %}
    </div>
    <div class="col-xs-22 col-xs-offset-1 col-sm-20 col-sm-offset-2 col-md-18 col-md-offset-3 col-lg-16 col-lg-offset-4">
      {% include 'review/components/expect.html' %}
    </div>
  </div>

  <div class="row" style="margin-top: 50px;">
    <div class="col-xs-22 col-xs-offset-1 col-sm-20 col-sm-offset-2 col-md-18 col-md-offset-3 col-lg-16 col-lg-offset-4">
    {% for i in "12345" %}
      {% cycle 'sort_name' 'sort_grade' 'sort_load' 'sort_speech' 'sort_total' as sort_id silent %}     
      <div class="list-group sort_result" id="{{ sort_id }}" role="tablist">
      {% if results|length == 0 %}
        <div class="list-group-item" >
          검색 결과가 없습니다.
        </div>
      {% endif %}

      {% for result in results %}
      <div id="datacall"></div>
      <li  class="list-group-item" >
          {{ result.title}}
      </li>
      {% endfor %}
      </div>
    {% endfor %}
    </div>
  </div>
{% endblock %}

{% block footer %}
  {{ block.super }}
{% endblock %}
