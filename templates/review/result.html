{% extends "review/layout.html" %}
{% load staticfiles %}

{% block title %}
  {{ block.super }}
{% endblock %}

{% block metatags %}
  {{ block.super }}
{% endblock %}

{% block stylesheets %}
  {{ block.super }}
  <link rel="stylesheet" type="text/css" href="/media/css/components/header/result.css">
  <link rel="stylesheet" type="text/css" href="/media/css/review/components/option.css">
  <link rel="stylesheet" type="text/css" href="/media/css/review/components/review.css">
  <link rel="stylesheet" type="text/css" href="/media/css/review/result.css">
{% endblock %}

{% block javascripts %}
  {{ block.super }}
  <script type="text/javascript" src="/media/js/review/result.js"></script>
  <script type="text/javascript" src="/media/js/review/components/option.js"></script>
  <script type="text/javascript">
    $('#category').on('focus', function() {
      $('#m-category').modal('show');
    });

    $(document).ready(function() {
      {% if 'by_professor' in gets %}
        $('#by_professor').addClass('active');
        $("input:checkbox[name='by_professor']").attr("checked", true);
      {% endif %}
      {% if 'sorting' in gets %}
        sorting = '{{ gets.sorting.0 }}';
      {% else %}
        sorting = 'name';
      {% endif %}
      sorts = $('#sorts>label>input');
      for (i=0; i<sorts.length; i++)
        if (sorts[i].value==sorting)
        {
          sorts[i].checked = true;
          sorts[i].parentElement.classList.add('active');
        }
      $(".sort_result").hide();
      $("#sort_"+sorting).show();
    });

    $('#by_professor').click(function() {
      if ($("input:checkbox[name='by_professor']").is(":checked"))
      {
        $('#by_professor').removeClass('active');
        $("input:checkbox[name='by_professor']").attr("checked", false);
      }
      else
      {
        $('#by_professor').addClass('active');
        $("input:checkbox[name='by_professor']").attr("checked", true);
      }
    
      {% for i in "12" %}
        {% cycle "department" "type" as filtername silent %}
        {% cycle gets.department gets.type as get_filter silent %}
        get_filter = [];
        {% for i in get_filter %}
          get_filter.push('{{i}}');
        {% endfor %}
        filters = $("input[name='{{filtername}}']");
        for (i=0; i<filters.length; i++)
          if (get_filter.indexOf(filters[i].value)!=-1)
            filters[i].checked = true;
          else
            filters[i].checked = false;
      {% endfor %}
      $('#filter_form').submit()
    });

    $("input[name='sorting']").on("change", function(){
      var test = $(this).val();
      $(".sort_result").hide();
      $("#sort_"+test).show();
    });

    $('div.sort_result>a').click(function(){
      lis = $('div.sort_result>a');
      for (i=0; i<lis.length; i++)
        if (lis[i].href == this.href)
          lis[i].classList.add("active");
        else
          lis[i].classList.remove("active");
    });
  </script>
{% endblock %}

{% block header %}
  {% include 'components/header/result.html' %}
{% endblock %}

{% block contents %}
  <div class="row">
    <div class="col-xs-22 col-xs-offset-1 col-sm-20 col-sm-offset-2 col-md-18 col-md-offset-3 col-lg-16 col-lg-offset-4">
      {% include 'review/components/option.html' with with_filter=True %}
    </div>
    <div class="col-xs-22 col-xs-offset-1 col-sm-20 col-sm-offset-2 col-md-18 col-md-offset-3 col-lg-16 col-lg-offset-4">
      {% include 'review/components/course.html' %}
    </div>
  </div>

  <div class="row" style="margin-top: 50px;">
    <div class="col-xs-12">
    {% for i in "12345" %}
      {% cycle results results_grade results_load results_speech results_total as results_sorted silent %}
      {% cycle 'sort_name' 'sort_grade' 'sort_load' 'sort_speech' 'sort_total' as sort_id silent %}     
      <div class="list-group sort_result" id="{{ sort_id }}" role="tablist">
      {% if results|length == 0 %}
        <div class="list-group-item">
          검색 결과가 없습니다.
        </div>
      {% endif %}
      {% for result in results_sorted %}
        <a href="{{ "#lecture"|add:result.3 }}" class="list-group-item" aria-controls="home" role="tab" data-toggle="tab">
          {{ result.0.0.title }}
        {% if result.0.1 != None %}
          : {{ result.0.1.professor_name }}
        {% endif %}
          </br>
        {% if result.2 != 0 %}
          grade : {{ result.1.0|floatformat:2 }}&nbsp;&nbsp;
          load : {{ result.1.1|floatformat:2 }}&nbsp;&nbsp;
          speech : {{ result.1.2|floatformat:2 }}&nbsp;&nbsp;
          total : {{ result.1.3|floatformat:2 }}</br>
          {{ result.2 }}개의 평가
        {% else %}
          -</br>
          평가 없음</br>
        {% endif %}
        </a>
      {% endfor %}
      </div>
    {% endfor %}
    </div>


    <div class="col-xs-12 tab-content">
    {% for result in results %}
      <div id="{{"lecture"|add:result.3 }}" role="tabpanel" class="tab-pane panel">
        <div class="panel-default">
          <ul class="list-group">
          {% for review in result.4 %}
            <li class="list-group-item">
              {{ review.lecture.year }}년 {{ review.lecture.semester }}학기 - {{ review.writer.user.id }}</br>
              {{ review.comment }}</br>
              grade : {{ review.grade }}&nbsp;&nbsp;
              load : {{ review.load }}&nbsp;&nbsp;
              speech : {{ review.speech }}&nbsp;&nbsp;
              total : {{ review.total }}</br>
              <button class="btn btn-default">
                좋아요 {{ review.like }}
              </button>
            </li>
          {% endfor %}
          </ul>
        </div>
      </div>
    {% endfor %}
    </div>
  </div>
{% endblock %}

{% block footer %}
  {{ block.super }}
{% endblock %}
