{% extends "review/layout.html" %}
{% load staticfiles %}

{% block title %}
  {{ block.super }}
{% endblock %}

{% block metatags %}
  {{ block.super }}
{% endblock %}

{% block stylesheets %}
  {{ block.super }}
  <link rel="stylesheet" type="text/css" href="/media/css/components/header/result.css">
  <link rel="stylesheet" type="text/css" href="/media/css/review/components/option.css">
  <link rel="stylesheet" type="text/css" href="/media/css/review/components/expect.css">
  <link rel="stylesheet" type="text/css" href="/media/css/review/components/course.css">
  <link rel="stylesheet" type="text/css" href="/media/css/review/components/review.css">
  <link rel="stylesheet" type="text/css" href="/media/css/review/result.css">
{% endblock %}

{% block javascripts %}
  {{ block.super }}
  {% include 'review/components/filter.js.html' %}
  <script type="text/javascript" src="/media/js/review/result.js"></script>
  <script type="text/javascript" src="/media/js/review/components/option.js"></script>
  <script type="text/javascript" src="/media/js/review/components/course.js"></script>
<script>
$(document).ready(function(){     
    $(window).bind('scroll', loadOnScroll);
});
var pageNum = {{page}};
var hasNextPage = true;


var loadOnScroll = function() {
    if ($(window).scrollTop() > $(document).height() - ($(window).height()*2)) {
        $(window).unbind();
        loadItems();
    }
};

var loadItems = function() {
    if (hasNextPage === false) {
        return false
    }
    pageNum = pageNum + 1;
    var url = window.location.href +"json/"+pageNum.toString()
    $.ajax({
        type:"GET",
        url: url, 
        success: function(responseData) {
            var data = JSON.parse(responseData);
            hasNextPage=data.hasNext;
            var html = [];
            $.each(data.results, function(index, result){
                if(result.type == "comment"){
                    html.push('<div class="panel panel-default review">') 
                        html.push('<button class="likes" disabled>') 
                            html.push('<span>') 
                                html.push('<i class="fa fa-plus"></i> <span>',result.like,'</span>') 
                            html.push('</span>') 
                        html.push('</button>') 
                        html.push('<div class="panel-body container-fluid">') 
                            html.push('<div class="row">') 
                                html.push('<div class="col-xs-24 lecture ellipsis-wrapper">') 
                                    html.push('<h4 class="ellipsis-content">',result.lecture_title,' <small class="text-muted">',result.professor_name, result.lecture_year,'</small></h4>') 
                                html.push('</div>') 
                                html.push('<div class="col-xs-24 comment text-muted">') 
                                    html.push(result.comment.replace(/\n/g , "<br>")) 
                                html.push('</div>') 
                                html.push('<div class="col-xs-24 statics text-right">') 
                                    html.push('<span class="text-left clearfix">') 
                                        html.push('성적') 
                                        gradelist = [[-1,'?'],[0,'F'],[1,'D'],[2,'C'],[3,'B'],[4,'A']]
                                        for(i=0;i<gradelist.length;i++){
                                            if(gradelist[i][0]==result.score.grade){
                                                html.push('<span class="grade pull-right">',gradelist[i][1],'</span>')
                                            }
                                        }
                                    html.push('</span>') 
                                scoretype=[['널널',result.score.load],['강의',result.score.speech],['종합',result.score.total]]
                                for(i=0;i<scoretype.length;i++){
                                    html.push('<span class="text-left clearfix">',scoretype[i][0])
                                    for(j=0;j<gradelist.length;j++){
                                            if(gradelist[j][0]==scoretype[i][1]){
                                                html.push('<span class="grade pull-right">',gradelist[j][1],'</span>')
                                            }
                                        }
                                    html.push('</span>') 
                                }

                                html.push('</div>') 
                            html.push('</div>') 
                        html.push('</div>') 
                    html.push('</div>') 
                }
            });
            $("#datacall").before(html.join(""));
        }, 
        error: function(){
            hasNextPage=false;
        },
        complete: function(data){
            $(window).bind('scroll', loadOnScroll);
        }
    });
};   
</script>

{% endblock %}

{% block header %}
  {% include 'components/header/result.html' %}
{% endblock %}

{% block contents %}
  <div class="row">
    <div class="col-xs-22 col-xs-offset-1 col-sm-20 col-sm-offset-2 col-md-18 col-md-offset-3 col-lg-16 col-lg-offset-4">
        {% include 'review/components/option.html' with with_filter=True %}
    </div>
    <div class="col-xs-22 col-xs-offset-1 col-sm-20 col-sm-offset-2 col-md-18 col-md-offset-3 col-lg-16 col-lg-offset-4">
      {% if expectations %}
        {% include 'review/components/expect.html' with lectures=expectations %}
      {% endif %}
    </div>
  </div>

  <div class="row">
    <div class="col-xs-22 col-xs-offset-1 col-sm-20 col-sm-offset-2 col-md-18 col-md-offset-3 col-lg-16 col-lg-offset-4">
    {% for i in "12345" %}
      {% cycle 'sort_name' 'sort_grade' 'sort_load' 'sort_speech' 'sort_total' as sort_id silent %}     
      <div class="list-group sort_result" id="{{ sort_id }}" role="tablist">
      {% if results|length == 0 %}
        <div class="list-group-item" >
          검색 결과가 없습니다.
        </div>
      {% endif %}
    
      {% if mainbox.type == "course" %}
<div class="panel panel-default course">
  <div class="panel-body">
    <div class="row">
      <div class="col-xs-24 col-sm-18">
        <div class="panel-title">
            <h4>{{mainbox.title}}</h4>
        </div>
        <div>
          <span class="label-title">
            담당 교수
          </span>
          <span class="label-description">
            <div class="professors">
              <label>
                <input class="professor chkall chkone" type="checkbox" autocomplete="off" name="selected_professor" checked="checked">
                <span class="label label-default">ALL</span>
              </label>

              {% for lecture in mainbox.lecture_list %}
              <label>
                <input class="professor chkelem chkone" type="checkbox" autocomplete="off" name="selected_professor">
                <span class="label label-default">{{lecture.professor_name}}</span>
              </label>
              {% endfor %}
            </div>
          </span>
        </div>
        <div>
          <span class="label-title">
            한줄 요약
          </span>
          <span class="label-description">
            등록되지 않았습니다. <i class="fa fa-pencil"></i>
          </span>
        </div>
        <div>
          <span class="label-title">
            주 교재
          </span>
          <span class="label-description">
            등록되지 않았습니다. <i class="fa fa-pencil"></i>
          </span>
        </div>
      </div>
      <div class="col-xs-24 col-sm-6">
        <h4 class="text-center">
          <span class="label label-danger">
            평균 점수
          </span>
        </h4>
        <div>
          <div class="col-xs-12">
            <p class="clearfix">
            성적 <span>{{mainbox.score.grade|floatformat:1}}</span>
            </p>
            <p class="clearfix">
            널널 <span>{{mainbox.score.load|floatformat:1}}</span>
            </p>
            <p class="clearfix">
            강의 <span>{{mainbox.score.speech|floatformat:1}}</span>
            </p>
          </div>
          <div class="col-xs-12">
            <div>
                <span>{{mainbox.score.total|floatformat:1}}</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
      {% endif %}

      {% if mainbox.type == "professor" %}
<div class="panel panel-default course">
  <div class="panel-body">
    <div class="row">
      <div class="col-xs-24 col-sm-18">
        <div class="panel-title">
            <h4>{{mainbox.professor_name}}</h4>
        </div>
        <div>
          <span class="label-title">
            담당 과목
          </span>
          <span class="label-description">
            <div class="professors">
              <label>
                <input class="professor chkall chkone" type="checkbox" autocomplete="off" name="selected_lecture" checked="checked">
                <span class="label label-default">ALL</span>
              </label>

              {% for lecture in mainbox.lecture_list %}
              <label>
                <input class="professor chkelem chkone" type="checkbox" autocomplete="off" name="selected_lecture">
                <span class="label label-default">{{lecture.title}}</span>
              </label>
              {% endfor %}
            </div>
          </span>
        </div>
        <div>
          <span class="label-title">
            한줄 요약
          </span>
          <span class="label-description">
            등록되지 않았습니다. <i class="fa fa-pencil"></i>
          </span>
        </div>
        <div>
          <span class="label-title">
            주 교재
          </span>
          <span class="label-description">
            등록되지 않았습니다. <i class="fa fa-pencil"></i>
          </span>
        </div>
      </div>
      <div class="col-xs-24 col-sm-6">
        <h4 class="text-center">
          <span class="label label-danger">
            평균 점수
          </span>
        </h4>
        <div>
          <div class="col-xs-12">
            <p class="clearfix">
            성적 <span>{{mainbox.score.grade|floatformat:1}}</span>
            </p>
            <p class="clearfix">
            널널 <span>{{mainbox.score.load|floatformat:1}}</span>
            </p>
            <p class="clearfix">
            강의 <span>{{mainbox.score.speech|floatformat:1}}</span>
            </p>
          </div>
          <div class="col-xs-12">
            <div>
                <span>{{mainbox.score.total|floatformat:1}}</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
      {% endif %}


    

      {% for result in results %}
<div class="panel panel-default review">
  <button class="likes" disabled>
    <span>
      <i class="fa fa-plus"></i> <span>{{ result.like }}</span>
    </span>
  </button>
  <div class="panel-body container-fluid">
    <div class="row">
      <div class="col-xs-24 lecture ellipsis-wrapper">
          <h4 class="ellipsis-content">{{ result.lecture_title }} <small class="text-muted">{{ result.professor_name }} {{ result.lecture_year }}</small></h4>
      </div>
      <div class="col-xs-24 comment text-muted">
        {{ result.comment|linebreaks }}
      </div>
      <div class="col-xs-24 statics text-right">
        <span class="text-left clearfix">
          성적
          {% for numbergrade, lettergrade in result.gradelist %}
            {% ifequal numbergrade result.score.grade %} <span class="grade pull-right">{{ lettergrade }}</span>{% endifequal %}
          {% endfor %}
        </span>
        {% for i in "123" %}
        <span class="text-left clearfix">
         {% cycle "널널" "강의" "종합" %}
         {% cycle result.score.load result.score.speech result.score.total as whichgrade silent %}
           {% for numbergrade, lettergrade in result.gradelist %}
             {% ifequal numbergrade whichgrade %} <span class="grade pull-right">{{ lettergrade }}</span>{% endifequal %}
           {% endfor %}
        </span>
        {% endfor %}
      </div>
    </div>
  </div>
</div>

      {% endfor %}
<div id="datacall"></div>
      </div>
    {% endfor %}
    </div>
  </div>
{% endblock %}

{% block footer %}
  {{ block.super }}
{% endblock %}
